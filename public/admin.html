<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Admin Management</title>
 <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f1f3f8;
      display: flex;
      min-height: 100vh;
      overflow: hidden; /* halaman utama tidak scroll */
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: #2c3e50;
      color: white;
      padding: 20px;
    }
    .sidebar h2 {
        color: white;
      text-align: center;
      margin-bottom: 30px;
      user-select: none;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar ul li {
      padding: 10px 0;
      border-bottom: 1px solid #3f556e;
      cursor: pointer;
      user-select: none;
    }
    .sidebar ul li:hover {
      background-color: #34495e;
    }

    /* Main content */
    .main {
      flex-grow: 1;
      padding: 30px;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* Card style */
    .card {
      background-color: #fff;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      /* remove max-width for form so it can stretch */
    }

    /* Headings */
    h2 {
      margin-top: 0;
      color: #333;
      user-select: none;
    }

    /* Form */
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    input {
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 100%;
    }
    button {
      padding: 12px;
      font-size: 16px;
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background-color: #2471a3;
    }

   /* Modal background */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow-y: auto;
  background: rgba(200, 220, 230, 0.4); /* soft biru muda transparan */
  backdrop-filter: blur(5px);
}

/* Modal box */
.modal-content {
  background: #f9faff; /* putih kebiruan sangat soft */
  margin: 7% auto;
  padding: 25px 30px;
  border-radius: 14px;
  width: 90%;
  max-width: 480px;
  box-shadow: 0 6px 20px rgba(100, 120, 140, 0.15);
  color: #3b4a6b; /* abu biru tua kalem */
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  border: 1.5px solid #aac9e5; /* border soft blue */
  position: relative;
}

/* Close button */
.close {
  position: absolute;
  right: 18px;
  top: 18px;
  font-size: 28px;
  font-weight: 600;
  cursor: pointer;
  color: #7a8ba6; /* abu kebiruan kalem */
  transition: color 0.3s ease, transform 0.3s ease;
  user-select: none;
}

.close:hover {
  color: #4a5d7b; /* sedikit lebih gelap */
  transform: scale(1.15);
}



    .list-container {
  background-color: #f9fafb;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  max-width: 1200px;
  margin: 20px auto;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;

  display: flex;
  flex-direction: column;
  max-height: 600px;
}

.list-container::-webkit-scrollbar {
  width: 8px;
}

.list-container::-webkit-scrollbar-track {
  background: transparent;
}

.list-container::-webkit-scrollbar-thumb {
  background-color: #a0aec0;
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: content-box;
}
    /* Header atas daftar akun (judul + search) */
 .header-flex {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 15px;
  user-select: none;
}
   .header-flex h2 {
  font-weight: 700;
  font-size: clamp(1.5rem, 2vw, 1.9rem);  /* font-size responsif */
  color: #2c3e50;
  margin: 0;
  flex-grow: 1;
  min-width: 200px;            /* beri ruang minimum lebih besar */
  user-select: none;
  line-height: 1.2;
}
    #searchInput {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      max-width: 300px;
      width: 100%;
      box-sizing: border-box;
    }
 .table-wrapper {
  flex-grow: 1;
  overflow-y: auto;
  border-radius: 8px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}


thead th {
  background-color: #f0f0f0;
  padding: 12px;
  border: 1px solid #ddd;
  position: sticky;
  top: 0;
  z-index: 10;
  font-weight: 600;
  color: #444;
  white-space: nowrap;
  text-align: center;
  user-select: none;
}

tbody td {
  border: 1px solid #ddd;
  padding: 12px 10px;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

tbody td:last-child {
  border-right: none;
}

tbody tr:hover {
  background-color: #f5f8ff;
  transition: background-color 0.3s ease;
  cursor: pointer;
}

tbody td:nth-child(2),
tbody td:nth-child(12) {
  text-align: left;
  padding-left: 16px;
  white-space: normal;
}

    /* Set width kolom */
    th:nth-child(1), td:nth-child(1) { width: 5%; }
    th:nth-child(2), td:nth-child(2) { width: 25%; text-align: left; padding-left: 12px; }
    th:nth-child(3), td:nth-child(3) { width: 30%; text-align: left; padding-left: 12px; }
    th:nth-child(4), td:nth-child(4) { width: 20%; }
    th:nth-child(5), td:nth-child(5) { width: 20%; }

    /* Tombol aksi */
    button.editBtn,
    button.deleteBtn {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.25s ease;
      margin: 0 4px;
      color: white;
      user-select: none;
    }
    button.editBtn {
      background-color: #3498db;
    }
    button.editBtn:hover {
      background-color: #2980b9;
    }
    button.deleteBtn {
      background-color: #e74c3c;
    }
    button.deleteBtn:hover {
      background-color: #c0392b;
    }

    /* Responsif */
    @media (max-width: 768px) {
      .list-container {
        max-height: 280px;
      }
      .header-flex {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      #searchInput {
        max-width: 100%;
      }
      /* Ubah tabel jadi block untuk mobile */
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        display: none; /* sembunyikan header */
      }
      tbody tr {
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
      }
      tbody td {
        text-align: right;
        padding-left: 50%;
        position: relative;
        white-space: normal;
        overflow: visible;
      }
      tbody td::before {
        content: attr(data-label);
        position: absolute;
        left: 12px;
        width: 45%;
        padding-left: 12px;
        font-weight: 600;
        text-align: left;
        white-space: nowrap;
      }
    }
  </style>

  <!-- Firebase SDK + JS -->
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getDatabase,
  ref,
  push,
  set,
  onValue,
  remove,
  update
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Konfigurasi Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBBAYrLjPDZDH1YrbRPV2_-cAIPXKuwFFM",
  authDomain: "posyanduapp-61635.firebaseapp.com",
  databaseURL: "https://posyanduapp-61635-default-rtdb.firebaseio.com",
  projectId: "posyanduapp-61635",
  storageBucket: "posyanduapp-61635.appspot.com",
  messagingSenderId: "665390164212",
  appId: "1:665390164212:web:8c75ce018b1128b356d6a1",
  measurementId: "G-8LJRMFNG0Z"
};

// Inisialisasi Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Navigasi sidebar
document.querySelectorAll('.sidebar ul li[data-target]').forEach(item => {
  item.addEventListener('click', () => {
    const targetPage = item.getAttribute('data-target');
    window.location.href = targetPage;
  });
});

// Tombol logout
const logoutBtn = document.getElementById('logoutBtn');
if (logoutBtn) {
  logoutBtn.addEventListener('click', () => {
    window.location.href = 'index.html';
  });
}

window.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("adminForm");
  const tableBody = document.getElementById("adminTable").querySelector("tbody");
  const searchInput = document.getElementById("searchInput");

  const namaInput = document.getElementById("nama");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");

  const modal = document.getElementById("adminModal");
  const openModalBtn = document.getElementById("openModalBtn");
  const closeModalBtn = document.querySelector(".modal .close");

  let editingKey = null;
  const adminsRef = ref(db, "admins");
  let allData = [];

  // Buka modal
  openModalBtn.addEventListener("click", () => {
    form.reset();
    editingKey = null;
    modal.style.display = "block";
  });

  // Tutup modal
  closeModalBtn.addEventListener("click", () => {
    form.reset();
    modal.style.display = "none";
  });

  // Tutup modal jika klik di luar kontennya
  window.addEventListener("click", (event) => {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  });

  // Tampilkan data admin
  function renderTable(filteredData) {
    tableBody.innerHTML = "";
    let count = 1;
    filteredData.forEach((data) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td data-label="No">${count++}</td>
        <td data-label="Nama">${data.nama}</td>
        <td data-label="Email">${data.email}</td>
        <td data-label="Password">${data.password}</td>
        <td data-label="Aksi">
          <button data-id="${data.key}" class="editBtn">Edit</button>
          <button data-id="${data.key}" class="deleteBtn">Hapus</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    // Tombol hapus
    tableBody.querySelectorAll(".deleteBtn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const key = e.target.dataset.id;
        if (confirm("Yakin ingin menghapus data ini?")) {
          remove(ref(db, `admins/${key}`));
          if (editingKey === key) {
            editingKey = null;
            form.reset();
          }
        }
      });
    });

    // Tombol edit
    tableBody.querySelectorAll(".editBtn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const key = e.target.dataset.id;
        const data = allData.find((d) => d.key === key);
        if (!data) return;
        namaInput.value = data.nama;
        emailInput.value = data.email;
        passwordInput.value = data.password;
        editingKey = key;
        modal.style.display = "block"; // Buka modal untuk edit
      });
    });
  }

  // Ambil data dari Firebase
  onValue(adminsRef, (snapshot) => {
    allData = [];
    snapshot.forEach((child) => {
      allData.push({ key: child.key, ...child.val() });
    });
    renderTable(allData);
  });

  // Pencarian
  searchInput.addEventListener("input", () => {
    const keyword = searchInput.value.toLowerCase();
    const filtered = allData.filter((data) =>
      data.nama.toLowerCase().includes(keyword)
    );
    renderTable(filtered);
  });

  // Submit form (tambah atau edit)
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const nama = namaInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();

    if (!nama || !email || !password) return;

    const emailExists = allData.some(
      (admin) => admin.email.toLowerCase() === email.toLowerCase() && admin.key !== editingKey
    );

    if (emailExists) {
      alert("Email sudah digunakan, silakan gunakan email lain.");
      return;
    }

    if (editingKey) {
      update(ref(db, `admins/${editingKey}`), { nama, email, password }).then(() => {
        editingKey = null;
        form.reset();
        modal.style.display = "none";
      });
    } else {
      const adminRef = push(ref(db, "admins"));
      set(adminRef, { nama, email, password }).then(() => {
        form.reset();
        modal.style.display = "none";
      });
    }
  });
});
</script>


</head>
<body>
  <div class="sidebar">
    <h2>Dashboard</h2>
    <ul>
      <li data-target="users.html">Input Users</li>
      <li data-target="admin.html">Input Admin</li>
      <li data-target="rekammedis.html">Rekam Medis</li>
      <li data-target="jadwal.html">Input Jadwal</li>
      <li data-target="statistik.html">Statistik</li>
      <li id="logoutBtn" style="cursor:pointer; color:#e74c3c; margin-top: 20px;">Logout</li>
    </ul>
  </div>

  <div class="main">
    <!-- Modal untuk input admin, posisi tetap di luar list-container -->
    <div id="adminModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Form Input Akun Admin</h2>
        <form id="adminForm">
          <label for="nama">Nama Lengkap</label>
          <input type="text" id="nama" placeholder="Nama Lengkap" required />

          <label for="email">Email</label>
          <input type="email" id="email" placeholder="Email" required />

          <label for="password">Password</label>
          <input type="text" id="password" placeholder="Password" required />

          <button type="submit">Simpan</button>
        </form>

      </div>
    </div>

    <!-- Container daftar admin -->
    <div class="list-container">
      <!-- Header tetap di atas -->
      <div class="header-flex">
        <h2>Daftar Akun Admin</h2>
        <input type="search" id="searchInput" placeholder="Cari berdasarkan nama..." />
        <button id="openModalBtn">+</button>
      </div>

      <!-- Wrapper scroll tabel -->
      <div class="table-wrapper">
        <table id="adminTable" aria-label="Daftar akun admin">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama</th>
              <th>Email</th>
              <th>Password</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <!-- Baris data akan dimasukkan di sini -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>

</html>
